var H=Object.defineProperty;var Z=(p,r,u)=>r in p?H(p,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[r]=u;var w=(p,r,u)=>Z(p,typeof r!="symbol"?r+"":r,u);import{d as G,u as J,a as K,x as Q,r as A,s as k,y as X,o as Y,q as L,A as R,S as f,c as x,b as t,t as E,i as tt,f as M,w as b,v as et,z as S,F as st,C as ot,k as at,B as $,n as C,D as nt}from"./index-Dwg6-SXH.js";const it="/week4-vue/assets/img2-CwWZoW3o.png";class lt{constructor(){w(this,"id",null);w(this,"createTime",0);w(this,"content","");w(this,"status",!1)}}class rt{constructor(){w(this,"content",null)}}const ct={id:"todoListPage",class:"bg-half"},ut=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),dt={class:"todo_sm"},ht={href:"#"},ft={class:"conatiner todoListPage vhContainer"},pt={class:"todoList_Content"},vt={class:"inputBox"},_t=t("i",{class:"fa fa-plus"},null,-1),mt=[_t],gt={key:0,class:"todoList_list"},wt={class:"todoList_tab"},kt={class:"todoList_items"},xt={class:"todoList_item"},Ct={class:"todoList_label"},Tt=["onUpdate:modelValue","onClick"],yt=["onClick"],Lt=t("i",{class:"fa fa-times"},null,-1),Rt=[Lt],$t={class:"todoList_statistics"},Bt={key:1,style:{"text-align":"center","padding-top":"4.5rem"}},It=t("p",null,"目前尚無代辦事項",-1),Et=t("img",{class:"d-m-n",src:it,alt:"workImg"},null,-1),Mt=[It,Et],bt=G({__name:"TodosView",setup(p){const r=at(),u=J(),c=K(),{cookies:j}=Q(),m=j.get("userInfo"),V=m?m.nickname:"未知",d=A(new lt);A(new rt);const T=k("all"),_=k([]),g=k([]),z=X(()=>g.value.filter(s=>s.status===!0).length);Y(async()=>{await u.checkout()||r.push("/sign-in"),await y()});const D=async()=>{await u.signOut(),r.push("/sign-in")},B=s=>{T.value=s,s==="all"?g.value=_.value:s==="complete"?g.value=_.value.filter(e=>e.status===!0):s==="uncomplete"&&(g.value=_.value.filter(e=>e.status===!1))},y=async()=>{await u.checkout()||r.push("/sign-in"),c.show();const e=`${$}/todos/`,o={Authorization:m.token};let n,l;try{n=(await L.get(e,{headers:o})).data,c.hide()}catch(i){if(i instanceof R){const a=i.response;n=a==null?void 0:a.data,l=n!=null&&n.message?`取得待辦事項失敗，${n.message}。`:"取得待辦事項失敗，請稍後再試。"}else l="取得待辦事項失敗，請稍後再試。";c.hide(),await f.fire({icon:"error",title:"取得待辦事項失敗",text:l})}n.status&&(_.value=n.data,g.value=_.value)},O=async()=>{if(await u.checkout()||r.push("/sign-in"),!P()||await F()&&!(await f.fire({icon:"info",title:"已有相同待辦事項",text:"是否要新增相同的待辦事項？",showCancelButton:!0,confirmButtonText:"是",cancelButtonText:"否"})).isConfirmed)return;const n=U();c.show();const l=`${$}/todos/`,i={Authorization:m.token};let a,h;try{a=(await L.post(l,n,{headers:i})).data,c.hide()}catch(v){if(v instanceof R){const I=v.response;a=I==null?void 0:I.data,h=a!=null&&a.message?`新增待辦事項失敗，${a.message}。`:"新增待辦事項失敗，請稍後再試。"}else h="新增待辦事項失敗，請稍後再試。";c.hide(),await f.fire({icon:"error",title:"新增待辦事項失敗",text:h});return}a.status&&(N(),await y(),await f.fire({icon:"success",title:"新增待辦事項成功",showConfirmButton:!1,timer:1500}))},F=async()=>{const s=k(!1),e=_.value.find(o=>o.content===d.content);return e&&d.id!==e.id&&(s.value=!0),s.value},P=()=>{const s=k(!0);let e="";if(d.content==="")return e="請輸入待辦事項",s.value=!1,f.fire({icon:"error",title:"新增待辦事項失敗",text:e}),s.value;let o=`${d.content}`;return o=o.replace(/\s+/g,""),o===""&&(e="待辦事項不可僅有空白",s.value=!1),s.value||f.fire({icon:"error",title:"新增待辦事項失敗",text:e}),s.value},U=()=>{const s=["id","status","createTime"],e={...d};return Object.keys(e).forEach(o=>{s.includes(o)&&delete e[o]}),e},N=()=>{d.id=null,d.createTime=0,d.content="",d.status=!1},W=async s=>{await u.checkout()||r.push("/sign-in"),c.show();const o=`${$}/todos/${s.id}/toggle`,n={Authorization:m.token};let l,i;try{l=(await L.patch(o,{},{headers:n})).data,c.hide()}catch(a){if(a instanceof R){const h=a.response;l=h==null?void 0:h.data,i=l!=null&&l.message?`切換待辦事項狀態失敗，${l.message}。`:"切換待辦事項狀態失敗，請稍後再試。"}else i="切換待辦事項狀態失敗，請稍後再試。";c.hide(),await f.fire({icon:"error",title:"切換待辦事項狀態失敗",text:i});return}l.status||await f.fire({icon:"error",title:"切換待辦事項狀態失敗",text:i}),await y()},q=async s=>{if(await u.checkout()||r.push("/sign-in"),!(await f.fire({icon:"warning",title:"刪除待辦事項",text:`確定要刪除「${s.content}」嗎?`,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed)return;c.show();const n=`${$}/todos/${s.id}`,l={Authorization:m.token};let i,a;try{i=(await L.delete(n,{headers:l})).data,c.hide()}catch(h){if(h instanceof R){const v=h.response;i=v==null?void 0:v.data,a=i!=null&&i.message?`刪除待辦事項失敗，${i.message}。`:"刪除待辦事項失敗，請稍後再試。"}else a="刪除待辦事項失敗，請稍後再試。";c.hide(),await f.fire({icon:"error",title:"刪除待辦事項失敗",text:a});return}i.status||await f.fire({icon:"error",title:"刪除待辦事項失敗",text:a}),await y()};return(s,e)=>(C(),x("div",ct,[t("nav",null,[ut,t("ul",null,[t("li",dt,[t("a",ht,[t("span",null,E(tt(V))+"的代辦",1)])]),t("li",null,[t("a",{href:"javascript:void(0)",onClick:M(D,["prevent"])},"登出")])])]),t("div",ft,[t("div",pt,[t("div",vt,[b(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=o=>d.content=o)},null,512),[[et,d.content]]),t("a",{href:"javascript:void(0)",onClick:M(O,["prevent"])},mt)]),_.value.length>0?(C(),x("div",gt,[t("ul",wt,[t("li",null,[t("a",{href:"javascript:void(0)",class:S({active:T.value==="all"}),onClick:e[1]||(e[1]=o=>B("all"))},"全部",2)]),t("li",null,[t("a",{href:"javascript:void(0)",class:S({active:T.value==="uncomplete"}),onClick:e[2]||(e[2]=o=>B("uncomplete"))},"待完成",2)]),t("li",null,[t("a",{href:"javascript:void(0)",class:S({active:T.value==="complete"}),onClick:e[3]||(e[3]=o=>B("complete"))},"已完成",2)])]),t("div",kt,[t("ul",xt,[(C(!0),x(st,null,ot(g.value,o=>(C(),x("li",null,[t("label",Ct,[b(t("input",{class:"todoList_input",type:"checkbox",value:"true","onUpdate:modelValue":n=>o.status=n,onClick:n=>W(o)},null,8,Tt),[[nt,o.status]]),t("span",null,E(o.content),1)]),t("a",{href:"javascript:void(0)",onClick:M(n=>q(o),["prevent"])},Rt,8,yt)]))),256))]),t("div",$t,[t("p",null,E(z.value)+" 個已完成項目",1)])])])):(C(),x("div",Bt,Mt))])])]))}});export{bt as default};
